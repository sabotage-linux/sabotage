[mirrors]
http://ftp.de.debian.org/debian/pool/main/p/procps/procps_3.3.9.orig.tar.xz

[main]
filesize=560812
sha512=62c7270aa48b4346a3198f306d1cb8474f64650bfb67e8cc6c4d41923e50c31c95b3a0367a464823fb50a6137ec0c6352006292ac85b50caf730ec8ec35eb553
tardir=procps-ng-3.3.9

[build]
#patch -p1 < "$K/some.patch" || exit 1
cat << EOF > include/error.h
#include <stdio.h>
#include <string.h>
#define HAVE_PROGRAM_INVOCATION_SHORT_NAME
#define PROGRAM_NAME "procps"

#define error(status, errnum, ...) \
  do { fflush(stdout); \
       dprintf(2, PROGRAM_NAME ": "); \
       dprintf(2, __VA_ARGS__); \
       if(errnum) dprintf(2, ": %s", strerror(errnum)); \
       dprintf(2, "\n"); \
       if(status) exit(status); \
  } while(0)

#define error_at_line(status, errnum, fn, line, ...) \
  do { fflush(stdout); \
       dprintf(2, PROGRAM_NAME ": %s:%d", fn, (int) line); \
       dprintf(2, __VA_ARGS__); \
       if(errnum) dprintf(2, ": %s", strerror(errnum)); \
       dprintf(2, "\n"); \
       if(status) exit(status); \
  } while(0)


EOF
mkdir -p include/sys
cat << EOF > include/sys/dir.h
#include <dirent.h>
#define direct dirent
EOF


STRIP=true CFLAGS="-O0 -g -D_GNU_SOURCE -DGLOB_TILDE=0 -DAF_INET6=10 -DAF_INET=2" ./configure --without-ncurses \
  -C --prefix="$butch_prefix" || exit 1
make -j$MAKE_THREADS || exit 1
make DESTDIR="$butch_install_dir" install || exit 1

dest="$butch_install_dir""$butch_prefix"
mv $dest/usr/bin/* $dest/bin/
